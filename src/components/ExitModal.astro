<div class="modal" id="modal" style="display: none;">
  <div class="modal__wrapper" tabindex="-1">
    <button
      class="button modal__close"
      data-dismiss="modal"
      aria-label="Close modal"
    >
      +
    </button>
    <div class="modal__content">
      <h1 class="modal__title">Leaving so soon?</h1>
      <p class="modal__sub-title">You are about to leave Strensiq-hcp.com</p>
      <div class="modal__buttons">
        <button data-dismiss="modal" id="back" class="button modal--stay"
          >Stay on the job</button
        >
        <a id="proceed" href="#" class="button button--white modal--continue"
          >Let's go</a
        >
      </div>

      <div class="modal__text">
        <p>
          You are now leaving strensiq-hcp.com, a website provided by Alexion
          Pharmaceuticals, Inc. This link will take you to a different site that
          is owned and operated by an independent third party to which this <br
          />
          <a class="modal__text-link">Privacy Notice</a> does not apply.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  import { Fancybox } from "@fancyapps/ui";
  const linksWithHideContent = [
    'https://alexionaccessnavigator.com/',
    'https://strensiq.com/',
    'https://alexion.com/',
    'https://alexion.com/Legal#legalstatement',
    'https://alexion.com/Legal#privacynotice',
    'https://alexion.com/Legal#termsofuse',
    'https://alexion.com/contact-alexion',
    'https://alexiononesource.com/'
  ]

  const externalLinks = document.querySelectorAll(
    'a[target="_blank"]:not(.document-link)'
  );

  if (externalLinks && externalLinks.length > 0) {
    externalLinks.forEach((link) => {
      link.addEventListener("click", (e) => {
        e.preventDefault();

        let instance: Fancybox;

        const href = link.getAttribute("href");
        const modal = document.querySelector("#modal");
        const continueLink = document.querySelector(".modal__text-link");
        const continueButton = modal.querySelector(".modal--continue");
        const stayButton = modal.querySelector(".modal--stay");
        const modalClose = modal.querySelector(".modal__close");
        const modalText = modal.querySelector(".modal__text")

        if (linksWithHideContent.indexOf(href) !== -1) {
          modalText.style.setProperty('display', 'none')
        }

        continueButton.setAttribute("href", href);
        continueButton.setAttribute("target", "_blank");

        stayButton.addEventListener("click", () => {
          instance.close();
        });
        modalClose.addEventListener("click", () => {
          instance.close();
        });

        continueButton.addEventListener("click", handleClickContinue);

        if (continueLink) {
          const secondaryLink = "https://alexion.com/Legal#privacynotice";
          continueLink.setAttribute('href', secondaryLink)
          continueLink.setAttribute('target', '_blank')
          continueLink.addEventListener("click", handleClickContinueLink);
        }

        instance = new Fancybox([{ src: "modal" }], {
          autoFocus: true,
          defaultType: "inline",
          placeFocusBack: true,
          trapFocus: true,
          closeButton: false,
          mainClass: "exit__modal_main",
          dragToClose: false,
          on: {
            close: () => {
              continueButton.removeEventListener('click', handleClickContinue)
              if(continueLink) {
                continueLink.removeEventListener("click", handleClickContinueLink)
              }
              modalText.style.removeProperty('display')
            },
          },
        });

        function handleClickContinue (event) {
          setTimeout(() => {
            instance.close();
          }, 500);
          return;
        }

        function handleClickContinueLink (event) {
          setTimeout(() => {
            instance.close();
          }, 500);
        }
      });
    });
  }
</script>
